<!DOCTYPE html>
<html>
<head>
  <style>
    .button {
      background-color: dodgerblue;
      border: none;
      width: 280px;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
    }
  </style>

	<title>ICS 414 Calendar Project</title>
	<script type="text/javascript">
// array of month names
var monthNames = [
	"January",
	"February",
	"March",
	"April",
	"May",
	"June",
	"July",
	"August",
	"September",
	"October",
	"November",
	"December"
];

// source: https://stackoverflow.com/questions/45831191/generate-and-download-file-from-js/45831280#45831280
function download(filename, text) {
	var element = document.createElement('a');
	element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
	element.setAttribute('download', filename);

	element.style.display = 'none';
	document.body.appendChild(element);

	element.click();

	document.body.removeChild(element);
}
// source: https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript/2117523#2117523
function uuidv4() {
	return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
		var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
		return v.toString(16);
	});
}
// function to generate formated timestamps from date object
function formatTimestamp(date) {
	// https://tools.ietf.org/html/rfc5545#section-3.3.5
	// FORM #2: DATE WITH UTC TIME
	// January 19, 1998, at 0700 UTC:
	// 19980119T070000Z

	// getUTCFullYear() returns YYYY
	var year = date.getUTCFullYear();
	// getUTCMonth() returns 0-11, we need 01-12
	var month = ((date.getUTCMonth() + 1) < 10 ? "0" : "") + (date.getUTCMonth() + 1);
	// getUTCDate() returns 1-31, we need 01-31
	var day = (date.getUTCDate() < 10 ? "0" : "") + date.getUTCDate();
	// getUTCHours() returns 0-23, we need 00-23
	var hours = (date.getUTCHours() < 10 ? "0" : "") + date.getUTCHours();
	// getUTCMinutes() returns 0-59, we need 00-59
	var minutes = (date.getUTCMinutes() < 10 ? "0" : "") + date.getUTCMinutes();
	// getUTCSeconds() returns 0-59, we need 00-59
	var seconds = (date.getUTCSeconds() < 10 ? "0" : "") + date.getUTCSeconds();

	return year + month + day + "T" + hours + minutes + seconds + "Z";
}
// function to add hour options to a select input
function generateHourOptions(elementId) {
	// get the select element to add options to
	var selectElement = document.getElementById(elementId);

	// create options for 12, 1, 2, ... 11
	for (var i = 0; i < 12; i++) {
		// create new option element
		var optionElement = document.createElement('option');
		// we need 0 to be 12
		optionElement.value = (i === 0 ? "12" : i);
		optionElement.innerHTML = (i === 0 ? "12" : i);
		// append new option element to the select element
		selectElement.appendChild(optionElement);
	}
}
// function to add minute options to a select input
function generateMinuteOptions(elementId) {
	// get the select element to add options to
	var selectElement = document.getElementById(elementId);

	// create options for 0, 1, 2, ... 59
	for (var i = 0; i < 60; i++) {
		// create new option element
		var optionElement = document.createElement('option');
		// we need 00-59
		optionElement.value = (i < 10 ? "0" : "") + i;
		optionElement.innerHTML = (i < 10 ? "0" : "") + i;
		// append new option element to the select element
		selectElement.appendChild(optionElement);
	}
}
// function to add month options to a select input
function generateMonthOptions(elementId) {
	// get the select element to add options to
	var selectElement = document.getElementById(elementId);

	// create options for each month, monthNames declared globally
	monthNames.forEach(function(month, index) {
		// create new option element
		var optionElement = document.createElement('option');
		optionElement.value = index;
		optionElement.innerHTML = month;
		// append new option element to the select element
		selectElement.appendChild(optionElement);
	});
}
// function to add day options to a select input
function generateDayOptions(elementId) {
	// get the select element to add options to
	var selectElement = document.getElementById(elementId);

	// create options for 1, 2, ... 31
	for (var i = 1; i <= 31; i++) {
		// create new option element
		var optionElement = document.createElement('option');
		optionElement.value = i;
		optionElement.innerHTML = i;
		// append new option element to the select element
		selectElement.appendChild(optionElement);
	}
}
// function to add year options to a select input
function generateYearOptions(elementId) {
	// get the select element to add options to
	var selectElement = document.getElementById(elementId);
	// set to current time
	var currentTime = new Date();

	// create options for YYYY, YYYY + 1, ... YYYY + 9
	for (var i = 0; i < 10; i++) {
		// create new option element
		var optionElement = document.createElement('option');
		optionElement.value = (currentTime.getUTCFullYear() + i);
		optionElement.innerHTML = (currentTime.getUTCFullYear() + i);
		// append new option element to the select element
		selectElement.appendChild(optionElement);
	}
}

window.onload = function() {
	// generate options for select inputs
	generateHourOptions("startHour");
	generateMinuteOptions("startMinute");
	generateHourOptions("finishHour");
	generateMinuteOptions("finishMinute");
	generateMonthOptions("dateMonth");
	generateDayOptions("dateDay");
	generateYearOptions("dateYear");
	// set the default start time to 8:00 AM
	document.getElementById("startHour").value = "8";
	document.getElementById("startMinute").value = "00";
	document.getElementById("startAMPM").value = "AM";
	// set the default end time to 12:00 PM
	document.getElementById("finishHour").value = "12";
	document.getElementById("finishMinute").value = "00";
	document.getElementById("finishAMPM").value = "PM";
	// get the current time
	var currentTime = new Date();
	// set the default date to today
	document.getElementById("dateMonth").value = currentTime.getMonth();
	document.getElementById("dateDay").value = currentTime.getDate();
	document.getElementById("dateYear").value = currentTime.getFullYear();

	document.getElementById("download-button").addEventListener("click", function() {
		// get user inputs
		var title = document.getElementById("title").value;
		var startHour = document.getElementById("startHour").value;
		var startMinute = document.getElementById("startMinute").value;
		var startAMPM = document.getElementById("startAMPM").value;
		var finishHour = document.getElementById("finishHour").value;
		var finishMinute = document.getElementById("finishMinute").value;
		var finishAMPM = document.getElementById("finishAMPM").value;
		var dateMonth = document.getElementById("dateMonth").value;
		var dateDay = document.getElementById("dateDay").value;
		var dateYear = document.getElementById("dateYear").value;
		var location = document.getElementById("location").value;
		var description = document.getElementById("description").value;
		// format user inputs
		// need hour in 0-23 integer, have 12, 1, 2 ... 11 string and AM/PM
		startHour = (startHour == "12" ? 0 : parseInt(startHour, 10)) + (startAMPM == "PM" ? 12 : 0);
		finishHour = (finishHour == "12" ? 0 : parseInt(finishHour, 10)) + (finishAMPM == "PM" ? 12 : 0);
		// need month in 0-59 integer, have 00-59 string
		startMinute = parseInt(startMinute, 10);
		finishMinute = parseInt(finishMinute, 10);
		// need month in 0-11 integer, have 0-11 string
		dateMonth = parseInt(dateMonth, 10);
		// need day in 1-31 integer, have 1-31 string
		dateDay = parseInt(dateDay, 10);
		// need year in YYYY integer, have YYYY string
		dateYear = parseInt(dateYear, 10);

		// set to current time
		var dtstamp = new Date();
		// set to user input
		var dtstart = new Date(dateYear, dateMonth, dateDay, startHour, startMinute, 0, 0);
		var dtend = new Date(dateYear, dateMonth, dateDay, finishHour, finishMinute, 0, 0);

		var filename = "event.ics";
		var text = "";
		text += "BEGIN:VCALENDAR\r\n";
		text += "VERSION:2.0\r\n";
		text += "PRODID:-//University of Hawaii//ICS 414 Calendar Project//EN\r\n";
		text += "BEGIN:VEVENT\r\n"; // https://tools.ietf.org/html/rfc5545#section-3.6.1
		text += "UID:" + uuidv4() + "\r\n"; // required
		text += "DTSTAMP:" + formatTimestamp(dtstamp) + "\r\n"; // required
		text += "DTSTART:" + formatTimestamp(dtstart) + "\r\n"; // required if METHOD not specified
		text += "DTEND:" + formatTimestamp(dtend) + "\r\n"; // optional

		// only include summary if title isn't empty
		if (title !== undefined && title.length > 0) {
			text += "SUMMARY:" + title + "\r\n"; // optional
		}
		// only include location if location isn't empty
		if (location !== undefined && location.length > 0) {
			text += "LOCATION:" + location + "\r\n"; // optional
		}
		// only include description if description isn't empty
		if (description !== undefined && description.length > 0) {
			text += "DESCRIPTION:" + description + "\r\n"; // optional
		}

		text += "END:VEVENT\r\n";
		text += "END:VCALENDAR\r\n";

		if(dateMonth === 1 || dateMonth === 3 || dateMonth === 5 || dateMonth === 8 || dateMonth === 10){
		  if(dateDay > 30) {
        alert("Try Again!");
      }

		  else if(dateMonth === 1 && dateDay > 28){
        alert("Try Again!");
      }

		  else {
        download(filename, text);
      }
    }

		else if ((startAMPM === "PM") && (finishAMPM === "AM")) {
      alert("Try Again!");
    }

    else if (startAMPM === finishAMPM) {
      if(startHour > finishHour) {
        alert("Try Again!");
      }

      else if(startHour === finishHour) {
        if (startMinute > finishMinute) {
          alert("Try Again!");
        } else {
          download(filename, text);
        }
      }

      else {
        download(filename, text);
      }
    }

		else {
      download(filename, text);
		}
	}, false);
}



	</script>
</head>
<body>
<div style = "margin: auto; padding: 10px; border: 3px solid dodgerblue; width: 55%">
  <h1 style="text-align:center; font-size:300%;">Welcome to ICS414 Calendaring System!</h1>
<h2></h2>
<div style="text-align:center; font-size:150%;">
	<label for="title">Title: </label>
	<input type="text" id="title" name="title" placeholder="Title (optional)" style ="font-size:60%" />
	<br />
	<label for="startHour">Start:</label>
	<select id="startHour" name="startHour"></select>
	<select id="startMinute" name="startMinute"></select>
	<select id="startAMPM" name="startAMPM">
		<option value="AM" selected>AM</option>
		<option value="PM">PM</option>
	</select>
	<br />
	<label for="finishHour">Finish:</label>
	<select id="finishHour" name="finishHour"></select>
	<select id="finishMinute" name="finishMinute"></select>
	<select id="finishAMPM" name="finishAMPM">
		<option value="AM" selected>AM</option>
		<option value="PM">PM</option>
	</select>
	<br />
	<label for="dateMonth">Date:</label>
	<select id="dateMonth" name="dateMonth"></select>
	<select id="dateDay" name="dateDay"></select>
	<select id="dateYear" name="dateYear"></select>
	<br />
	<label for="location">Location:</label>
	<input type="text" id="location" name="location" placeholder="Location (optional)" style ="font-size:60%" />
	<br />
	<label for="description">Description:</label>
	<br />
	<textarea id="description" name="description" placeholder="Description (optional)" style ="font-size:60%" ></textarea>
	<br />
  <button class="button" id="download-button">
    Download Event .ics File
  </button>
  <br>




</div>
</div>
</body>
</html>
